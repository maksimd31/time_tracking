{% extends 'base.html' %}
{% load custom_filters %}

{% block content %}
{% include 'time_tracking_main/partials/history_counter_controls.html' %}

<div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center mb-4 mt-3">
    <div>
        <h1 class="h3 mb-1">{{ counter.name }}</h1>
        <p class="text-muted-soft mb-0">История всех интервалов и ручных записей</p>
    </div>
    <div class="mt-3 mt-lg-0 d-flex gap-2">
        <a class="btn btn-outline-secondary" href="{% url 'home' %}">Назад</a>
        <a class="btn btn-outline-secondary" href="{% url 'counter_update' counter.id %}">Редактировать</a>
        <form method="post" action="{% url 'counter_delete' counter.id %}" onsubmit="return confirm('Удалить счетчик? Все интервалы будут удалены.');">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-danger">Удалить</button>
        </form>
        <a class="btn btn-primary" href="{% url 'counter_manual_interval' counter.id %}">Добавить интервал</a>
    </div>
</div>


<div id="history-stats">
    {% include 'time_tracking_main/partials/history_stats.html' %}
</div>

{% if intervals %}
<div id="history-intervals" class="table-responsive">
    <table class="table table-modern align-middle history-table">
        <thead>
        <tr>
            <th scope="col" style="width:72px;">№</th>
            <th scope="col">Дата</th>
            <th scope="col">Старт</th>
            <th scope="col">Стоп</th>
            <th scope="col">Длительность</th>
            <th scope="col" class="text-end">Действия</th>
        </tr>
        </thead>
        <tbody id="history-intervals-body">
        {% for interval in intervals %}
            {% with num=page_obj.start_index|add:forloop.counter0 %}
                {% include 'time_tracking_main/partials/history_interval_row.html' with interval=interval number=num filter_start=filter_start filter_end=filter_end %}
            {% endwith %}
        {% endfor %}
        </tbody>
    </table>
</div>
{% include 'includes/pagination.html' %}
{% else %}
<div class="card">
    <div class="card-body text-center py-5">
        <h5 class="fw-semibold">Интервалы не найдены</h5>
        <p class="text-muted-soft">Попробуйте изменить фильтры или добавьте первый интервал вручную.</p>
    </div>
</div>
{% endif %}
{% endblock %}
