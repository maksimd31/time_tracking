{% load custom_filters %}
<div id="history-counter-controls" class="card mb-4" data-history-controls>
  <div class="card-body d-flex flex-column flex-md-row align-items-md-center gap-4">
    <div class="flex-grow-1">
      <h5 class="mb-1">Управление: {{ counter.name }}</h5>
      <div class="text-muted-soft small">Запускайте и останавливайте интервалы прямо здесь</div>
      <div class="mt-2 d-inline-flex flex-column px-3 py-2 bg-white rounded-3 shadow-sm">
        <span class="text-muted-soft">Текущая длительность</span>
        <span class="fw-semibold timer-display"
              data-counter-timer
              data-offset="{{ active_total|default:0 }}"
              {% if active_interval %}
                data-interval-timer
                data-start="{{ active_interval.day|date:'Y-m-d' }}T{{ active_interval.start_time|time:'H:i:s' }}"
              {% endif %}>
            {% if active_interval %}{{ active_interval.duration|default:'0 ч 00 мин 00 секунд' }}{% else %}0 ч 00 мин 00 секунд{% endif %}
        </span>
      </div>
    </div>
    <div class="d-flex flex-wrap gap-2 align-items-center">
      <form method="post"
            class="counter-action-form start-form"
            hx-post="{% url 'counter_start' counter.id %}"
            hx-target="#history-counter-controls"
            hx-swap="outerHTML"
            hx-disabled-elt="button">
        {% csrf_token %}
        <input type="hidden" name="history" value="1">
        {% if page_obj.number %}<input type="hidden" name="page" value="{{ page_obj.number }}">{% endif %}
        <button type="submit" class="btn btn-outline-secondary btn-start"
                {% if active_interval %}disabled{% endif %}>Старт</button>
      </form>
      <form method="post"
            class="counter-action-form stop-form"
            hx-post="{% url 'counter_stop' counter.id %}"
            hx-target="#history-counter-controls"
            hx-swap="outerHTML"
            hx-disabled-elt="button">
        {% csrf_token %}
        <input type="hidden" name="history" value="1">
        {% if page_obj.number %}<input type="hidden" name="page" value="{{ page_obj.number }}">{% endif %}
        <button type="submit" class="btn btn-outline-secondary btn-stop"
                {% if not active_interval %}disabled{% endif %}>Стоп</button>
      </form>
      <form method="post"
            class="counter-action-form pause-form"
            hx-post="{% url 'counter_pause' counter.id %}"
            hx-target="#history-counter-controls"
            hx-swap="outerHTML"
            hx-disabled-elt="button">
        {% csrf_token %}
        <input type="hidden" name="history" value="1">
        {% if page_obj.number %}<input type="hidden" name="page" value="{{ page_obj.number }}">{% endif %}
        <button type="submit" class="btn btn-outline-secondary"
                {% if not active_interval %}disabled{% endif %}>Пауза</button>
      </form>
    </div>
  </div>
</div>
